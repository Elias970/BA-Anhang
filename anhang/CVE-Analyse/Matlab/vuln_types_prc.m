% Script für die Berechnung der Prozentualen Häufigkeit von CVEs
filePaths = {'cvelists/moodle_cves.csv', 'cvelists/ilias_cves.csv', 'cvelists/stud-ip_cves.csv'};
lmsNames = {'Moodle', 'Ilias', 'StudIp'};

owaspTypes = {'A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10'};
owaspCounts = zeros(3, 10);  % Matrix für die Zählungen der OWASP-Typen

% CSV durchsuchen
for i = 1:length(filePaths)
    % Lese die CSV-Datei mit der Option, die ursprünglichen Spaltennamen zu erhalten
    data = readtable(filePaths{i}, 'VariableNamingRule', 'preserve');
    % Vorkommen zählen
        for j = 1:length(owaspTypes)
            owaspCounts(i, j) = sum(strcmp(data.('OWASP-Typ'), owaspTypes{j}));
        end
end


% Berechne die relativen Anteile der OWASP-Typ-Zählungen für jedes LMS in %
owaspPercentages = (owaspCounts ./ sum(owaspCounts, 2)) * 100;

% 0-Werte entfernen
owaspTypesFiltered = owaspTypes(any(owaspCounts > 0, 1));
owaspPercentagesFiltered = owaspPercentages(:, any(owaspCounts > 0, 1));

% Balkendiagramm erstellen
figure;
b = bar(owaspPercentagesFiltered, 'grouped');
set(gca, 'XTickLabel', lmsNames);
xlabel('LMS Systeme');
ylabel('Anteil der CWEs nach OWASP (%)');
title('Prozentuale Verteilung der CWEs nach OWASP');
legend(owaspTypesFiltered, 'Location', 'northeastoutside');
grid on;

ylim([0 40]);

% Werte über den Balken anzeigen
for i = 1:length(b)  % Gehe durch jede OWASP-Typ Gruppe
    xtips = b(i).XEndPoints;
    ytips = b(i).YEndPoints;
    labels = string(round(b(i).YData, 1));
    for j = 1:length(labels)
        if b(i).YData(j) > 0  % Null Werte ausblenden
            text(xtips(j), ytips(j), labels(j), 'HorizontalAlignment', 'center', 'VerticalAlignment', 'bottom', 'FontSize', 8);
        end
    end
end

% Werte für jedes System printen
for i = 1:length(lmsNames)
    fprintf('Werte für %s:\n', lmsNames{i});
    for j = 1:length(owaspTypesFiltered)
        fprintf('%s: %.2f%%\n', owaspTypesFiltered{j}, owaspPercentagesFiltered(i, j));
    end
    fprintf('\n');
end